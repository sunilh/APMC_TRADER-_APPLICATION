Step-by-Step Fix for Replit "Port not exposed" Error
âœ… 1. Make sure you're binding to process.env.PORT â€” only
Don't fallback to port 5000 at all â€” Replit will break if the wrong port is used.

Update your line like this:

ts
Copy
Edit
const port = Number(process.env.PORT);
No default. Replit always provides process.env.PORT, so it's safe.

âœ… 2. Ensure you're binding to 0.0.0.0 (you already do this âœ…)
You're already doing this:

ts
Copy
Edit
httpServer.listen(port, '0.0.0.0', () => {
ðŸ‘ That part is correct.

âœ… 3. Add a simple / route before anything else
Replit's health check hits / â€” so add this before anything async (like Vite):

ts
Copy
Edit
app.get('/', (_req, res) => {
  res.send('ðŸŸ¢ Server is running.');
});
âœ… 4. Confirm .replit file has correct run command
In .replit, you should have:

toml
Copy
Edit
run = "npx tsx index.ts"
Or, if you're compiling with tsc:

toml
Copy
Edit
run = "node dist/index.js"
You can check by clicking the â€œâ‹®â€ next to the Run button > Show hidden files > .replit.

âœ… 5. Avoid Awaiting setupVite() If It Blocks Server Startup
If setupVite() sets up the dev server and holds the event loop (common with Vite's middleware), Replit might never detect the port bind.

ðŸ‘‰ Temporarily comment out Vite and try a plain Express setup:

ts
Copy
Edit
// Comment out for testing
// await setupVite(app, httpServer);
Then test again. If it works now, the problem is Vite never returning in time â€” in that case, use a static build for Replit.

âœ… 6. Final Minimal Server Code for Replit
Hereâ€™s a version that always works on Replit:

ts
Copy
Edit
import express from 'express';

const app = express();
const port = Number(process.env.PORT);

app.get('/', (_req, res) => {
  res.send('ðŸŸ¢ Hello from Replit!');
});

app.listen(port, '0.0.0.0', () => {
  console.log(`âœ… Listening on http://localhost:${port}`);
});
Test this first. If it works, gradually reintroduce your routes and Vite config.

âœ… Optional: Force Expose the Port (Fallback)
In Replit, open the "Shell" tab and run:

bash
Copy
Edit
kill 1
This sometimes resets internal proxies that get stuck.

ðŸ§  Final Debug Checklist
âœ… Check	Status
Only using process.env.PORT	Must
Binding to 0.0.0.0	âœ…
Simple / route exists	âœ…
.replit uses correct run command	âœ…
No async hanging in setupVite	Try removing temporarily
App console logs show no crash	âœ…
No fallback default ports used	âœ…